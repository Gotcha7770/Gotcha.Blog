---
title: "–ì—Ä–æ–∫–∞–µ–º Traversable"
icon: üïµÔ∏è‚Äç‚ôÇÔ∏è
date: 2022-12-15 10:06:00 +0300
tags: [–ø–µ—Ä–µ–≤–æ–¥, dev, F#]
---

–ì—Ä–æ–∫–Ω—É–≤ Traversable, –≤—ã —É–¥–∏–≤–∏—Ç–µ—Å—å, –∫–∞–∫ –≤—ã –≤–æ–æ–±—â–µ —Ä–∞–Ω—å—à–µ –∂–∏–ª–∏ –±–µ–∑ –Ω–µ–≥–æ. –ü–æ–ø—ã—Ç–∫–∏ –ø–æ–Ω—è—Ç—å Traversable –ø—Ä–æ—Å—Ç–æ –≥–ª—è–¥—è –Ω–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—É —Ç–∏–ø–∞ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ—Å—Ç–∞–≤–ª—è–ª–∏ –º–Ω–µ –æ—Å–æ–±–æ–≥–æ —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏—è. –ü–æ—ç—Ç–æ–º—É, –≤ —ç—Ç–æ–º –ø–æ—Å—Ç–µ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥ –∏ —Å–∞–º–∏ –ø—Ä–∏–¥—É–º–∞–µ–º –µ–≥–æ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–µ—à–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ–π –∑–∞–¥–∞—á–∏. –¢–∞–∫ –º—ã –ø—Ä–æ—á—É–≤—Å—Ç–≤—É–µ–º –º–æ–º–µ–Ω—Ç –æ—Å–æ–∑–Ω–∞–Ω–∏—è, –∫–æ–≥–¥–∞ –Ω–∞–∫–æ–Ω–µ—Ü –ø–æ–π–º–µ–º, –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ –≥–¥–µ –µ–≥–æ –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å.

## –¢–µ—Å—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –º—ã —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–¥ –æ–Ω–ª–∞–π–Ω –º–∞–≥–∞–∑–∏–Ω–æ–º, –∏ –æ–Ω —É—Å—Ç—Ä–æ–µ–Ω –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è - –µ—Å–ª–∏ —Ç–æ–≤–∞—Ä –∑–∞–∫–æ–Ω—á–∏–ª—Å—è –Ω–∞ —Å–∫–ª–∞–¥–µ, –æ–Ω –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ –ø—Ä–æ–¥–∞–∂–∏. –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑, –º—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—à–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –µ—Å—Ç—å –≤ –Ω–∞–ª–∏—á–∏–∏, –º—ã –≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ–º –µ–≥–æ, –ø—Ä–µ–∂–¥–µ, —á–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞.

–ù–∞—à–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∑–∞–¥–∞—á–∞ - –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `createCheckout` –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –æ–±—ä–µ–∫—Ç `Basket` –∏ –ø—ã—Ç–∞–µ—Ç—Å—è –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É. –ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–¥—É–∫—Ç—ã –±—ã–ª–∏ —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã, —Ñ—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞—Å—Ç –æ–±—ä–µ–∫—Ç `Checkout`, –≤–∫–ª—é—á–∞—é—â–∏–π –æ–±—â—É—é —Å—É–º–º—É –∑–∞–∫–∞–∑–∞ –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è –¥–ª—è –æ–ø–ª–∞—Ç—ã.

–ù–∞—à–∞ –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫

```F#
type BasketItem =
    { ItemId: ItemId
      Quantity: float }

type Basket =
    { Id: BasketId;
      Items: BasketItem list }

type ReservedBasketItem =
    { ItemId: ItemId
      Price: float }

type Checkout =
    { Id: CheckoutId
      BasketId: BasketId
      Price: float }
```

–§—É–Ω–∫—Ü–∏—è `createCheckout` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø `Checkout option`. –û–Ω–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `Some`, –µ—Å–ª–∏ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –±—ã–ª–∏ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã –∏ `None`, –µ—Å–ª–∏ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–æ–≤–∞—Ä—ã –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å. –°–µ—Ä—å–µ–∑–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã –±—ã–ª–æ –≤–µ—Ä–Ω—É—Ç—å —Ç–∏–ø `Result` –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏, –Ω–æ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `Option` –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã.

```F#
let createCheckout (basket: Basket): Checkout option
```

–ò –∫–∞–∫ –≤—Å–µ–≥–¥–∞ –Ω–∞–º –≤–µ–∑–µ—Ç, –∫—Ç–æ-—Ç–æ —É–∂–µ –Ω–∞–ø–∏—Å–∞–ª —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç `BasketItem` –Ω–∞ —Å–∫–ª–∞–¥–µ

```F#
let reserveBasketItem (item: BasketItem): ReservedBasketItem option
```

## –ù–∞—à–∞ –ø–µ—Ä–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

–ü–æ—Ö–æ–∂–µ, –≤—Å–µ, —á—Ç–æ –Ω–∞–º –Ω—É–∂–Ω–æ - –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `reserveBasketItem` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –≤ –∫–æ—Ä–∑–∏–Ω–µ. –ï—Å–ª–∏ –≤—Å–µ –≤—ã–∑–æ–≤—ã –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ, –º—ã –≤—ã—á–∏—Å–ª—è–µ–º –æ–±—â—É—é —Ü–µ–Ω—É –∏ —Å–æ–∑–¥–∞–µ–º `Checkout`

```F#
let createCheckout basket =
    let reservedItems =
        basket.Items |> List.map reserveBasketItem

    let totalPrice =
        reservedItems
        |> List.sumBy (fun item -> item.Price)

    { Id = CheckoutId "some-checkout-id"
      BasketId = basket.Id
      Price = totalPrice }
```

–ú—ã –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–±–∏—Ä–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∫–æ—Ä–∑–∏–Ω–µ, –∏, –ø—Ä–∏ –ø–æ–º–æ—â–∏ —É–∂–µ –∑–Ω–∞–∫–æ–º–æ–π –Ω–∞–º —Ñ—É–Ω–∫—Ü–∏–∏ `map`, –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ö –≤ –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã. –ê –∑–∞—Ç–µ–º –ø—Ä–æ—Ö–æ–¥–∏–º—Å—è –ø–æ –ø–æ–ª—É—á–∏–≤—à–µ–π—Å—è –∫–æ–ª–ª–µ–∫—Ü–∏–∏, —á—Ç–æ–±—ã –ø–æ—Å—á–∏—Ç–∞—Ç—å —Å—É–º–º—É –∫–æ—Ä–∑–∏–Ω—ã. –ö–æ–¥ –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–æ—Å—Ç—ã–º –∏ –ø–æ–Ω—è—Ç–Ω—ã–º, —Ç–æ–ª—å–∫–æ –≤–æ—Ç –æ–Ω –Ω–µ —Å–∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è.

–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç–æ–º, —á—Ç–æ `reservedItems` –∏–º–µ–µ—Ç —Ç–∏–ø `list<option<ReservedBasketItem>>`, –∞ –Ω–∞–º –Ω–∞–¥–æ, —á—Ç–æ–±—ã —Ç–∏–ø –±—ã–ª `option<list<ReservedBasketItem>>`, –≥–¥–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `None`, –∫–æ–≥–¥–∞ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ —É–¥–∞–ª–æ—Å—å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å. –ú—ã —Å–º–æ–∂–µ–º —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ —Å–æ–∑–¥–∞—Ç—å `Checkout` —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ —Ç–æ–≤–∞—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º, —á—Ç–æ –º—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Ç–∞–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é `reserveItems`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–º –Ω—É–∂–Ω—ã–π —Ç–∏–ø.

```F#
let reserveItems (items: BasketItem list): option<list<ReservedBasketItem>>

let createCheckout basket =
    let reservedItems = basket.Items |> reserveItems

    reservedItems
    |> Option.map
        (fun items ->
            { Id = CheckoutId "some-checkout-id"
              BasketId = basket.Id
              Price = items |> List.sumBy (fun x -> x.Price) })
```

–£–∂–µ –ª—É—á—à–µ! –¢–µ–ø–µ—Ä—å, –µ—Å–ª–∏ –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω—ã, —Ñ—É–Ω–∫—Ü–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Some` –∏ –º—ã –º–æ–∂–µ–º –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ `ReservedBasketItem`. –ï—Å–ª–∏ –∫–∞–∫–æ–π-–ª–∏–±–æ –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω, –º—ã –ø–æ–ª—É—á–∏–º `None` –∏ —Ñ—É–Ω–∫—Ü–∏—è `Option.map` –ø—Ä–µ—Ä–≤–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ, —Å—Ç–∞–ª–æ –±—ã—Ç—å `createCheckout` —Ç–æ–∂–µ –≤–µ—Ä–Ω–µ—Ç `None`.

–ú—ã —Å–≤–µ–ª–∏ –∑–∞–¥–∞—á—É –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ `reserveItems`. –£–∂–µ –ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –º—ã –Ω–µ –º–æ–∂–µ–º –ø—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `List.map reserveBasketItem`, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∏–ø–∞ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –∏–¥—É—Ç –Ω–µ –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ - —Å–Ω–∞—á–∞–ª–∞ `list` –∏ –∑–∞—Ç–µ–º `option`. –ù–∞–º –Ω–∞–¥–æ –ø—Ä–∏–¥—É–º–∞—Ç—å —Å–ø–æ—Å–æ–± –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö!

## –ò–Ω–≤–µ—Ä—Ç–æ—Ä

–ù–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º, –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–¥—É–º—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é `invertor`, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç `list<option<ReservedBasketItem>>` –≤ `option<list<ReservedBasketItem>>`. –° —ç—Ç–æ–π –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–µ–π –º—ã –ª–µ–≥–∫–æ –Ω–∞–ø–∏—à–µ–º `reserveItems`

```F#
let invert (reservedItems: list<option<ReservedBasketItem>>) : option<list<ReservedBasketItem>>

let reserveItems (items: BasketItem list) : option<list<ReservedBasketItem>> =
    items
    |> List.map reserveBasketItem
    |> invert
```

–ß—Ç–æ–±—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é, –Ω–∞—á–Ω–µ–º —Å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–ø–∏—Å–∫–µ

```F#
let invert (reservedItems: list<option<ReservedBasketItem>>) : option<list<ReservedBasketItem>> =
    match reservedItems with
    | head :: tail -> // –¥–µ–ª–∞–µ—Ç —á—Ç–æ-—Ç–æ, –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –Ω–µ –ø—É—Å—Ç
    | [] -> // –¥–µ–ª–∞–µ—Ç —á—Ç–æ-—Ç–æ —Å –ø—É—Å—Ç—ã–º —Å–ø–∏—Å–∫–æ–º
```

–£ –Ω–∞—Å –µ—Å—Ç—å –¥–≤–∞ —Å–ª—É—á–∞—è:

1. –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç, –æ—á–µ–≤–∏–¥–Ω–æ, —á—Ç–æ –æ–Ω –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–æ–∫, –∑–Ω–∞—á–∏—Ç –º—ã –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `Some[]`
2. –µ—Å–ª–∏ —Å–ø–∏—Å–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç, –º—ã –ø–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç - `head`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç `ReservedBaskedItem option` –∏ –æ—Å—Ç–∞—Ç–æ–∫ - `tail`, —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞, —á—Ç–æ –∏ –∏–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ `list<option<ReservedBasketItem>>`

–ù–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç—Å—è —Ä–µ—à–µ–Ω–∏–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `invert` –Ω–∞ `tail`

```F#
let rec invert (reservedItems: list<option<ReservedBasketItem>>) : option<list<ReservedBasketItem>> =
    match reservedItems with
    | head :: tail ->
        let invertedTail = invert tail
        // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –∑–∞–Ω–æ–≤–æ —Å–æ–µ–¥–∏–Ω–∏—Ç—å head –∏ –∏–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π tail
    | [] -> Some []
```

–¢–µ–ø–µ—Ä—å –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å `ReservedBasketItem option`, –∫–æ—Ç–æ—Ä—ã–π –ª–µ–∂–∏—Ç –≤ `head` –∏ `option<list<ReservedBasketItem>>`, –∫–æ—Ç–æ—Ä—ã–π –ª–µ–∂–∏—Ç –≤ `tail`. –ï—Å–ª–∏ –±—ã –æ–±–∞ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ –±—ã–ª–∏ –±—ã –æ–±–µ—Ä–Ω—É—Ç—ã –≤ `option` –º—ã –ø—Ä–æ—Å—Ç–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –±—ã –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ `::`. –ß—Ç–æ –∂, –º—ã –º–æ–∂–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ –¥–ª—è `option` –∑–Ω–∞—á–µ–Ω–∏–π.

```F#
let consOptions (head: option 'a) (tail: option<list<'a>>): option<list<'a>> =
    match head, tail with
    | Some h, Some t -> Some (h :: t)
    | _ -> None
```

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, —Ç—É—Ç –Ω–µ—Ç –Ω–∏—á–µ–≥–æ —Å–ª–æ–∂–Ω–æ–≥–æ. –ú—ã –ø—Ä–æ–≤–µ—Ä—è–µ–º –æ–±–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–∞, —è–≤–ª—è—é—Ç—Å—è –ª–∏ –æ–Ω–∏ –∑–Ω–∞—á–µ–Ω–∏–µ–º `Some`, –∏ –µ—Å–ª–∏ –¥–∞, —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º, –æ–±—ä–µ–¥–∏–Ω—è–µ–º –ø—Ä–∏ –ø–æ–º–æ—â–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ `::` –∏ –∑–∞–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ –≤ `Some`. –í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º `None`.

–ù–∞–∫–æ–Ω–µ—Ü —Å–æ–±—Ä–∞–≤ –≤—Å–µ —á—Ç–æ –º—ã –Ω–∞–ø–∏—Å–∞–ª–∏, –º—ã –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `invert`

```F#
let rec invert (reservedItems: list<option<'a>>) : option<list<'a>> =
    match reservedItems with
    | head :: tail -> consOptions head (invert tail)
    | [] -> Some []
```

–ú—ã —Ç–∞–∫–∂–µ —Å–º–æ–≥–ª–∏ —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –æ–±–æ–±—â–µ–Ω–Ω—ã–º, –ø–æ—Å–∫–æ–ª—å–∫—É —Å–ø–∏—Å–æ–∫ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª—é–±—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ `ReservedBasketItem`.

## –ü—Ä–∏—á–µ—à–µ–º –∫–æ–¥ –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ç–æ—Ä–∞

–ï—Å–ª–∏ –≤—ã –∑–Ω–∞–∫–æ–º—ã —Å –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω—ã–º —Ñ—É–Ω–∫—Ç–æ—Ä–æ–º, –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º—É —á—Ç–æ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —ç—Ç–æ–π —Å–µ—Ä–∏–µ–π –∏ —á–∏—Ç–∞–ª–∏ –ø–æ—Å—Ç [–ì—Ä–æ–∫–∞–µ–º –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ç–æ—Ä—ã][1], –≤—ã –º–æ–≥–ª–∏ –∑–∞–º–µ—Ç–∏—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `consOptions` –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –Ω–µ–∫–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è `apply`. –î–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ `consOptions` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –æ–±–µ—Ä–Ω—É—Ç—ã–µ –≤ `option` –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç –∏—Ö –∫ —Ñ—É–Ω–∫—Ü–∏–∏.

–ú—ã –º–æ–∂–µ–º –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `invert` –ø—Ä–∏ –ø–æ–º–æ—â–∏ `apply`

```F#
let rec invert list =
    // –ø—Å–µ–≤–¥–æ–Ω–∏–º –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ '::' - —Ç–∞–∫ –º—ã —Å–º–æ–∂–µ–º –ø–µ—Ä–µ–¥–∞—Ç—å –µ–≥–æ –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—é –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
    let cons head tail = head :: tail

    match list with
    | head :: tail -> Some cons |> apply head |> apply (invert tail)
    | [] -> Some []
```

–ü–æ-—Ö–æ—Ä–æ—à–µ–º—É, —Ç–∏–ø, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω—ã–º —Ñ—É–Ω–∫—Ç–æ—Ä–æ–º, —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `pure`. –£ `pure` –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ - –æ–±–µ—Ä–Ω—É—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Ç–∏–ø –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å–ª—É—á–∞–µ —Å `option`, `pure` —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –≤—ã–∑–æ–≤ `Some`.

–í–æ–∑—å–º–µ–º `pure` –∏ –µ—â–µ –Ω–µ–º–Ω–æ–≥–æ —É–ª—É—á—à–∏–º –Ω–∞—à –∫–æ–¥

```F#
let rec invert list =
    let cons head tail = head :: tail

    match list with
    | head :: tail -> pure cons |> apply head |> apply (invert tail)
    | [] -> pure []
```

–ö–∞–∑–∞–ª–æ—Å—å –±—ã –Ω–µ –±–æ–ª—å—à–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ, –Ω–æ –º—ã —É–±—Ä–∞–ª–∏ –≤—Å–µ —É–ø–æ–º–∏–Ω–∞–Ω–∏—è —Ç–∏–ø–∞ `option`, –≤ —Ç–µ–æ—Ä–∏–∏ —Ç–∞–∫–æ–π –º–µ—Ç–æ–¥ –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ª—é–±—ã–º –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω—ã–º —Ñ—É–Ω–∫—Ç–æ—Ä–æ–º, —Ç–∞–∫–∏–º –∫–∞–∫ `Result` –∏–ª–∏ `Validation`. –ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ, F# –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç–∞–∫–æ–π —É—Ä–æ–≤–µ–Ω—å –∞–±—Å—Ç—Ä–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –Ω–∞–º –ø—Ä–∏–¥–µ—Ç—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –≤–µ—Ä—Å–∏—é `invert` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω–æ–≥–æ —Ç–∏–ø–∞, —Å –∫–æ—Ç–æ—Ä—ã–º –º—ã —Ö–æ—Ç–∏–º –µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å.

–í–æ–æ–±—â–µ –µ—Å—Ç—å –æ–±—Ö–æ–¥–Ω–æ–π –ø—É—Ç—å —Å –ø–æ–º–æ—â—å—é [—Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–µ—à–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–∏–ø–∞][4] –Ø –±—ã –ø–æ—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–ª –∏–∑—É—á–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É [FSharpPlus][3], –µ—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–∞ —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–∏—Å–∞—Ç—å –≤—Å–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ.

## –ü–æ–∑–¥—Ä–∞–≤–ª—è—é, –≤—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã–ª–∏ `sequence`

–§—É–Ω–∫—Ü–∏—è `invert` - —ç—Ç–æ –æ–¥–Ω–∞ –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–∏–ø `Traversable`, —Ç–æ–ª—å–∫–æ –µ–µ –ø—Ä–∏–Ω—è—Ç–æ –Ω–∞–∑—ã–≤–∞—Ç—å `sequence`. –ö–∞–∫ –º—ã —É–±–µ–¥–∏–ª–∏—Å—å, `sequence` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–ª–ª–µ–∫—Ü–∏—é –∑–Ω–∞—á–µ–Ω–∏–π –æ–±–µ—Ä–Ω—É—Ç—ã—Ö –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø, –Ω–∞–ø–æ–¥–æ–±–∏–µ `option` –∏ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –≤ –∫–æ–ª–ª–µ–∫—Ü–∏—é –æ–±–µ—Ä–Ω—É—Ç—É—é –≤ —ç—Ç–æ—Ç —Ç–∏–ø. –ú–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è `sequence` –º–µ–Ω—è–µ—Ç –º–µ—Å—Ç–∞–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∏–ø–∞.

`sequence` —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –º–Ω–æ–≥–∏—Ö —Ç–∏–ø–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –º–æ–∂–µ—Ç–µ –≤–∑—è—Ç—å `list<Result<'a>>` –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –µ–≥–æ –≤ `Result<list<'a>>`. –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, —á—Ç–æ–±—ã –æ–¥–∏–Ω –∏–∑ —Ç–∏–ø–æ–≤ –±—ã–ª –∏–º–µ–Ω–Ω–æ –∫–æ–ª–ª–µ–∫—Ü–∏–µ–π, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–∫–∂–µ –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑
`Result<option<'a>, 'e>` –≤ `option<Result<'a, 'e>>`

## –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ `sequence`

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ `list<Result<_>>` –≤ `Result<list<_>>`

<details>
  <summary>—Ä–µ—à–µ–Ω–∏–µ</summary>

```F#
module Result =
    let apply a f =
        match f, a with
        | Ok g, Ok x -> g x |> Ok
        | Error e, Ok _ -> e |> Error
        | Ok _, Error e -> e |> Error
        | Error e, Error _ -> e |> Error

    let pure = Ok

let rec sequence list =
    let cons head tail = head :: tail

    match list with
    | head :: tail -> Result.pure cons |> Result.apply head |> Result.apply (sequence tail)
    | [] -> Result.pure []
```

–ö–∞–∫ –≤–∏–¥–∏—Ç–µ, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ—á–µ–Ω—å –ø–æ—Ö–æ–∂–∞ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –¥–ª—è `list<option<_>>`, –º—ã –ø—Ä–æ—Å—Ç–æ –ø–æ–¥—Å—Ç–∞–≤–∏–ª–∏ –º–µ—Ç–æ–¥—ã `Result.apply` –∏ `Result.pure`. –Ø –≤–∫–ª—é—á–∏–ª –∏—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤ –º–æ–¥—É–ª—å `Result`.

</details>

## –ö–æ–µ —á—Ç–æ –µ—â–µ –æ—Å—Ç–∞–ª–æ—Å—å –Ω–µ–æ—Ç–∫—Ä—ã—Ç—ã–º

–í–µ—Ä–Ω–µ–º—Å—è –∫ –Ω–∞—à–µ–π –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ –∏ –ø–æ—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ä–µ—à–µ–Ω–∏–µ —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `sequence`

```F#
let createCheckout basket =
    let reservedItems =
        basket.Items
        |> List.map reserveBasketItem
        |> sequence

    reservedItems
    |> Option.map
        (fun items ->
            { Id = CheckoutId "some-checkout-id"
              BasketId = basket.Id
              Price = items |> Seq.sumBy (fun x -> x.Price) })
```

–í—ã–≥–ª—è–¥–∏—Ç –Ω–µ–ø–ª–æ—Ö–æ. –û–¥–Ω–∞–∫–æ, –º—ã –¥–≤–∞–∂–¥—ã –ø—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —ç–ª–µ–º–µ–Ω—Ç–∞–º –∫–æ—Ä–∑–∏–Ω—ã: –ø–µ—Ä–≤—ã–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –ø—ã—Ç–∞–µ–º—Å—è –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π –∏–∑ —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –∏ –≤—Ç–æ—Ä–æ–π, –∫–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é `sequence` –æ–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏—è, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –ª–∏ —É—Å–ø–µ—à–Ω–æ –æ–ø–µ—Ä–∞—Ü–∏—è –≤ —Ü–µ–ª–æ–º. –ß—Ç–æ –Ω–∞–º –º–µ—à–∞–µ—Ç —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ –≤ –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥?

–ú—ã –º–æ–≥–ª–∏ –±—ã –ø–µ—Ä–µ–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `reserveBasketItem` –≤ `sequence`, –∑–Ω–∞—á–∏—Ç —Ç–µ–ø–µ—Ä—å —É –Ω–∞—Å –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞

```F#
let sequence (f: 'a -> 'b option) (list: 'a list): option<list<'b>>
```

–ú—ã –ø–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏ –ø—ã—Ç–∞–µ–º—Å—è –ø—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `f` –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É —ç—Ç–æ–≥–æ —Å–ø–∏—Å–∫–∞. –ü—Ä–∏ —ç—Ç–æ–º, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã —Å–ø–∏—Å–∫–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å `list<option<'b>>`, –º—ã —Å—Ä–∞–∑—É –∂–µ —Ö–æ—Ç–∏–º —Å–∞–≥–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ `option<list<'b>>`.

```F#
let rec sequence f list =
    let cons head tail = head :: tail

    match list with
    | head :: tail -> Some cons |> apply (f head) |> apply (sequence tail f)
    | [] -> Some []
```

–≠—Ç–æ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Ç–∞ –∂–µ —Ñ—É–Ω–∫—Ü–∏—è, —á—Ç–æ –º—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Ä–∞–Ω–µ–µ, –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–µ, —á—Ç–æ –¥–æ–±–∞–≤–∏–ª–æ—Å—å - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ `f` –∫ `head` –∏ –ø–µ—Ä–µ–¥–∞—á–∞ `f` –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –¥–∞–ª–µ–µ –≤ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤. –ú—ã –æ–±—ä–µ–¥–∏–Ω–∏–ª–∏ –∏ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–µ, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `option` –∏ –ø—Ä–æ—Ü–µ—Å—Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∑–Ω–∞—á–µ–Ω–∏–π.

## –ü–æ–∑–¥—Ä–∞–≤–ª—è—é, –≤—ã —Ç–æ–ª—å–∫–æ —á—Ç–æ –æ—Ç–∫—Ä—ã–ª–∏ `traverse`

–¢–∞–∫–æ–µ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `sequence` –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏–Ω—è—Ç–æ –Ω–∞–∑—ã–≤–∞—Ç—å `traverse`. –¢–æ –µ—Å—Ç—å `Traversable` —ç—Ç–æ —Ç–∏–ø, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –¥–≤–µ —Ñ—É–Ω–∫—Ü–∏–∏ `sequence` –∏ `traverse`. –ü—Ä–∏—á–µ–º `sequence`, –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, –ø—Ä–æ—Å—Ç–æ —á–∞—Å—Ç–Ω—ã–π —Å–ª—É—á–∞–π `traverse`, –≥–¥–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –≤—ã—Å—Ç—É–ø–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—è `id` (_—ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –µ–≥–æ, —Ç–æ –µ—Å—Ç—å –ø–æ —Å—É—Ç–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, x => x, –ø—Ä–∏–º. –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞_). –ú—ã –º–æ–∂–µ–º –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å `sequence` —Ç–∞–∫:

```F#
let sequence = traverse id
```

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è `traverse`, –º—ã, –Ω–∞–∫–æ–Ω–µ—Ü, —Ä–µ—à–∏–ª–∏ –Ω–∞—à—É –∑–∞–¥–∞—á—É.

```F#
let createCheckout basket =
    basket.Items
    |> traverse reserveBasketItem
    |> Option.map
        (fun items ->
            { Id = CheckoutId "some-checkout-id"
              BasketId = basket.Id
              Price = items |> Seq.sumBy (fun x -> x.Price) })
```

## –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–≤–æ–µ –ø–æ–Ω–∏–º–∞–Ω–∏–µ `traverse`

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å–º–æ–∂–µ—Ç–µ –ª–∏ –≤—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `traverse` –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `option<'a>` –∏ —Ñ—É–Ω–∫—Ü–∏—é `'a -> Result<'b, 'c>`, –∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Result<option<'b>, 'c>`

<details>
  <summary>—Ä–µ—à–µ–Ω–∏–µ</summary>

```F#
module Result =
    let apply a f =
        match f, a with
        | Ok g, Ok x -> g x |> Ok
        | Error e, Ok _ -> e |> Error
        | Ok _, Error e -> e |> Error
        | Error e1, Error _ -> e1 |> Error

    let pure = Ok

let traverse f opt =
    match opt with
    | Some x -> Result.pure Some |> Result.apply (f x)
    | None -> Result.pure None
```

–Ø –µ—â–µ —Ä–∞–∑ –≤–∫–ª—é—á–∏–ª –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π `apply` –∏ `pure`. –ù–∞–¥–µ—é—Å—å —Ç–∞–∫ –±—É–¥–µ—Ç –ø–æ–Ω—è—Ç–Ω–µ–µ, –∫–∞–∫–∞—è —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ `traverse` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –≤–Ω–µ—à–Ω–∏–º —Ç–∏–ø–æ–º `option`, –∞ –∫–∞–∫–∞—è —Å –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–º `Result`.

–†–µ–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞, –≥–¥–µ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è —Ç–∞–∫–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä—Å–µ—Ä–∞. –î–æ–ø—É—Å—Ç–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è —Å —Å–∏–≥–Ω–∞—Ç—É—Ä–æ–π

```F#
string -> Result<int, ParseError>
```

–Ω–æ –Ω–∞–º –Ω–∞–¥–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –µ–µ –∫ –∑–Ω–∞—á–µ–Ω–∏—é `string option`. –ö–æ–Ω–µ—á–Ω–æ, –º–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç—å pattern matching –∏ –≤—ã–∑–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –ø–∞—Ä—Å–µ—Ä–∞ –≤ –≤–µ—Ç–≤–∏ `Some`, –∞ –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å

```F#
myOptionalValue |> traverse parseInt
```

</details>

–î—Ä—É–≥–æ–π –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —É –Ω–∞—Å –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–µ–æ–±—Ä–∞–∑—É—é—â–∞—è –∞—Ä–≥—É–º–µ–Ω—Ç –≤ —Å—Ç—Ä–æ–∫—É. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å `traverse`, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –≤–æ—Ç —Ç–∞–∫ `[1; 2; 3] |> traverse stringify` –∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `["1"; "2"; "3"]`

<details>
  <summary>—Ä–µ—à–µ–Ω–∏–µ</summary>

```F#
module Identity =
    let apply a f = f a
    let pure f = f

let rec traverse list f =
    let cons head tail = head :: tail

    match list with
    | head :: tail -> Identity.pure cons |> Identity.apply (f head) |> Identity.apply (traverse tail f)
    | [] -> Identity.pure []

```

–Ø –Ω–∞–ø–∏—Å–∞–ª —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é —Ç–∞–∫–∏–º –∂–µ –æ–±—Ä–∞–∑–æ–º, –∫–∞–∫ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ, –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ç–æ—Ä–∞ `Identity`. `Identity` —è–≤–ª—è–µ—Ç—Å—è –≤—ã—Ä–æ–∂–¥–µ–Ω–Ω—ã–º —Å–ª—É—á–∞–µ–º, –ø–æ—Ç–æ–º—É –µ–≥–æ `apply` –ø—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é —Å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º, –∞ `pure` –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π. `Identity` –Ω–µ –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç —Å–≤–æ–∏ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤–æ —á—Ç–æ-–ª–∏–±–æ, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ç–æ—Ä–æ–≤. –ò–∑-–∑–∞ —ç—Ç–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏—è `traverse` –ø–æ–ª—É—á–∏–ª–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—É

```F#
list<'a> -> ('a -> 'b) -> list<'b>
```

–∏ –µ—Å–ª–∏ –≤—ã —á–∏—Ç–∞–ª–∏ –ø–æ—Å—Ç [–ì—Ä–æ–∫–∞–µ–º —Ñ—É–Ω–∫—Ç–æ—Ä—ã][4], —Ç–æ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —É–∑–Ω–∞–ª–∏ —Ñ—É–Ω–∫—Ü–∏—é `map`. –¢–∞–∫ –∏ –µ—Å—Ç—å, `map` –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ —á–∞—Å—Ç–Ω—ã–π —Å–ª—É—á–∞–π `traverse` –≥–¥–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ç–∏–ø–∞ - —ç—Ç–æ `Identity`.

</details>

## `Traversable` –≤ –¥–∏–∫–æ–π –ø—Ä–∏—Ä–æ–¥–µ

–í—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ —É –≤–∞—Å –µ—Å—Ç—å –Ω–∞–±–æ—Ä –∑–Ω–∞—á–µ–Ω–∏–π, –∑–∞–≤–µ—Ä–Ω—É—Ç—ã–π –≤–æ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ `option` –∏–ª–∏ `Result`, –Ω–æ –≤–∞–º –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –Ω—É–∂–µ–Ω `option<list<'a>>` –∏–ª–∏ `Result<list<'a>, 'e>`, `sequence` —ç—Ç–æ —Ç–æ, —á—Ç–æ –º–æ–∂–µ—Ç –≤–∞–º –ø–æ–º–æ—á—å. –ï—Å–ª–∏ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏ –ø–æ–º–µ–Ω—è—Ç—å –º–µ—Å—Ç–∞–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–∏–ø–æ–≤ –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É –Ω–µ–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é, —Ç—É—Ç —É–∂–µ –º–æ–∂–Ω–æ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `traverse`.

## –í–Ω–∏–º–∞–Ω–∏–µ –ø—Ä—è–º–æ –ø–æ –∫—Ä—É—Å—É –¥–≤–∞ —Ç–∏–ø–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫!

–ö–æ–≥–¥–∞ –º—ã –∏–º–µ–µ–º –¥–µ–ª–æ —Å —Ç–∏–ø–æ–º `list<option<_>>`, –Ω–∞–º –Ω–∞–¥–æ –∑–Ω–∞—Ç—å, —á—Ç–æ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ `None`, —á—Ç–æ–±—ã –≤–µ—Ä–Ω—É—Ç—å `None`. –ï—Å–ª–∏ –≤—ã –ø–æ–º–Ω–∏—Ç–µ, –≤ –ø–æ—Å—Ç–µ [–ì—Ä–æ–∫–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø—Ä–∏ –ø–æ–º–æ—â–∏ –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ç–æ—Ä–∞][5] –º—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø—Ä–æ–±–ª–µ–º–æ–π –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ç–∏–ø–∞ `list<Result<'a, 'e>>`. –ï—Å—Ç—å –¥–≤–∞ –ø–æ–¥—Ö–æ–¥–∞ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫: –ø—Ä–µ–∫—Ä–∞—â–µ–Ω–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π –∏ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫. –¢–æ –∂–µ —Å–∞–º–æ–µ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ –∏ –¥–ª—è —Ç–∏–ø–∞ `Traversable`.

–ú—ã –º–æ–∂–µ–º –ø–æ—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–º —Å–µ–∞–Ω—Å–µ F# —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —É–∂–µ —É–ø–æ–º—è–Ω—É—Ç–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `FsharpPlus`

```F#
> [Ok 1; Error "first error"; Error "second error"] |> sequence;;
val it : Result<int list, string> = Error "first error"

[Success 1; Failure ["first error"]; Failure ["second error"]] |> sequence;;
val it : Validation<string list, int list> =
  Failure ["first error"; "second error"]
```

(_–í—Å–µ –ø—Ä–∏–º–µ—Ä—ã —ç—Ç–æ–π —Å–µ—Ä–∏–∏ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç—ã–µ, –∏ –º–æ–∂–µ—Ç –≤–æ–∑–Ω–∏–∫–Ω—É—Ç—å –≤–æ–ø—Ä–æ—Å, –∑–∞—á–µ–º –º—ã –Ω–∞–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –≤—Å–µ —ç—Ç–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏, –¥–ª—è —Ç–∞–∫–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã—Ö –∑–∞–¥–∞—á, –º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø–∞—Ä—É `if`, –æ–±—ä—è–≤–∏—Ç—å –ø–∞—Ä—É –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –¥–µ–ª–æ —Å –∫–æ–Ω—Ü–æ–º. –ò–º–µ–Ω–Ω–æ —ç—Ç–æ –º–µ—Å—Ç–æ, –∫–∞–∫ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —è—Ä–∫–æ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Å–∏–ª—É —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞. –ö–æ–≥–¥–∞ –º—ã —Ä–∞–∑–±–∏—Ä–∞–ª–∏ –∞–ø–ø–ª–∏–∫–∞—Ç–∏–≤–Ω—ã–π —Ñ—É–Ω–∫—Ç–æ—Ä, –º—ã –Ω–∞—Ç–∫–Ω—É–ª–∏—Å—å –Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –æ—à–∏–±–æ–∫. –ú—ã –≤—ã–¥–µ–ª–∏–ª–∏ `—ç—Ñ—Ñ–µ–∫—Ç` –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ç–∏–ø, —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –æ–¥–Ω–æ–æ–±—Ä–∞–∑–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º, –Ω–µ –∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –≤ —á–µ–º —ç—Ñ—Ñ–µ–∫—Ç –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è. –ö–æ–≥–¥–∞ –Ω–∞–º –ø–æ—Ç—Ä–µ–±–æ–≤–∞–ª—Å—è —Ç–æ—Ç –∂–µ —Å–∞–º—ã–π —ç—Ñ—Ñ–µ–∫—Ç, –Ω–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥—Ä—É–≥–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π, –æ–∫–∞–∑–∞–ª–æ—Å—å, —á—Ç–æ —É –Ω–∞—Å —É–∂–µ –µ—Å—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ –æ–Ω–∞ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –æ–∂–∏–¥–∞–µ–º—ã–º –æ–±—Ä–∞–∑–æ–º. –ø—Ä–∏–º. –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞_)

## –ß–µ–º—É –º—ã –Ω–∞—É—á–∏–ª–∏—Å—å?

`Traversable` —ç—Ç–æ –±–æ–ª–µ–µ –º–æ—â–Ω–∞—è –≤–µ—Ä—Å–∏—è `map`, –æ—Å–æ–±–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω–∞—è, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –µ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—è, –∫–æ—Ç–æ—Ä—É—é –º—ã —Ö–æ—Ç–∏–º –≤—ã–ø–æ–ª–Ω–∏—Ç—å (–∏–ª–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–∏–ª–∏) –Ω–∞–¥ —Å–ø–∏—Å–∫–æ–º –∑–Ω–∞—á–µ–Ω–∏–π. –ü—Ä–∏ —ç—Ç–æ–º –µ—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å –æ—à–∏–±–∫–æ–π, –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–æ–Ω–µ—á–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –º—ã —Ö–æ—Ç–∏–º —Ç–∞–∫–∂–µ –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É. –ï—â–µ –æ–¥–∏–Ω —Å–ø–æ—Å–æ–± –≥—Ä–æ–∫–Ω—É—Ç—å `TRaversable` - –ø–æ–Ω—è—Ç—å, —á—Ç–æ –æ–Ω –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±–æ–±—â–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞. –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º `traverse`, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ, –∏ `sequence`, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –Ω–∞–ø—Ä–æ—Ç–∏–≤ —É–∂–µ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫–∏—Ö-—Ç–æ –≤—ã—á–∏—Å–ª–µ–Ω–∏–π.

[1]:
[2]: https://learn.microsoft.com/ru-ru/dotnet/fsharp/language-reference/generics/statically-resolved-type-parameters
[3]: https://fsprojects.github.io/FSharpPlus/
[4]:
[5]:
